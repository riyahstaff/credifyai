
import React, { useEffect } from 'react';
import DisputeLettersPage from '../components/disputes/letters/DisputeLettersPage';
import { useToast } from '@/hooks/use-toast';

const DisputeLetters = () => {
  const { toast } = useToast();

  useEffect(() => {
    // Check for any generated letters when this page loads
    const autoGeneratedFlag = sessionStorage.getItem('autoGeneratedLetter');
    const pendingLetter = sessionStorage.getItem('pendingDisputeLetter');
    const generatedLetters = sessionStorage.getItem('generatedDisputeLetters');
    
    console.log("[DisputeLetters] Checking for auto-generated letter flags");
    console.log("[DisputeLetters] autoGeneratedFlag:", autoGeneratedFlag);
    console.log("[DisputeLetters] pendingLetter:", pendingLetter ? "Present" : "Not present");
    console.log("[DisputeLetters] generatedLetters:", generatedLetters ? "Present" : "Not present");
    
    // Show appropriate toast if we have letters
    if (autoGeneratedFlag === 'true') {
      let letterCount = 0;
      
      if (generatedLetters) {
        try {
          const letters = JSON.parse(generatedLetters);
          letterCount = letters.length;
        } catch (e) {
          console.error("Error parsing generated letters:", e);
        }
      } else if (pendingLetter) {
        letterCount = 1;
      }
      
      if (letterCount > 0) {
        toast({
          title: "Dispute Letters Ready",
          description: `${letterCount} dispute ${letterCount === 1 ? 'letter has' : 'letters have'} been generated based on your credit report analysis.`,
          duration: 5000,
        });
      }
    }
  }, [toast]);

  return <DisputeLettersPage />;
};

export default DisputeLetters;
