
/**
 * Utility functions for clearing letter data from storage
 */

/**
 * Clear all letter-related data from session and local storage
 */
export const clearAllLetterData = (): void => {
  console.log("Clearing ALL letter data from storage");
  
  // Clear all letter data from session storage
  sessionStorage.removeItem('pendingDisputeLetter');
  sessionStorage.removeItem('generatedDisputeLetters');
  sessionStorage.removeItem('autoGeneratedLetter');
  sessionStorage.removeItem('reportReadyForLetters');
  sessionStorage.removeItem('forceLetterGeneration');
  sessionStorage.removeItem('letterGenerationTime');
  sessionStorage.removeItem('generationComplete');
  sessionStorage.removeItem('hasDisputeLetters');
  sessionStorage.removeItem('fallbackLetterUsed');
  sessionStorage.removeItem('lettersAlreadyLoaded'); 
  
  // Clear any flags that might trigger letter generation
  sessionStorage.removeItem('shouldNavigateToLetters');
  sessionStorage.removeItem('forceLettersReload');
  sessionStorage.removeItem('navigationInProgress');
  sessionStorage.removeItem('analysisComplete');
  sessionStorage.removeItem('reportAnalyzed');
  
  // Also clear from local storage for completeness
  localStorage.removeItem('pendingDisputeLetter');
  localStorage.removeItem('generatedDisputeLetters');
  localStorage.removeItem('reportData');
  localStorage.removeItem('disputeLetters');
  
  console.log("Letter data cleared successfully");
};

/**
 * Force a complete reset of all data and reload the page
 * This is a "nuclear option" for when other clearing methods fail
 */
export const forceClearAndReload = (): void => {
  console.log("FORCE CLEARING all data and reloading page");
  
  // Clear all letter data
  clearAllLetterData();
  
  // Clear ALL session storage (complete reset)
  sessionStorage.clear();
  
  // Clear report-related items from local storage
  localStorage.removeItem('creditReportData');
  localStorage.removeItem('reportData');
  localStorage.removeItem('disputeTargetAccount');
  localStorage.removeItem('reportStorageTime');
  
  // Set a flag that we're doing a force reload
  sessionStorage.setItem('forceReload', 'true');
  
  // Force reload the page after a brief delay
  setTimeout(() => {
    window.location.reload();
  }, 100);
};

/**
 * Check if any letter data exists in storage
 */
export const hasLetterData = (): boolean => {
  return !!(
    sessionStorage.getItem('pendingDisputeLetter') ||
    sessionStorage.getItem('generatedDisputeLetters') ||
    sessionStorage.getItem('autoGeneratedLetter') ||
    localStorage.getItem('pendingDisputeLetter') ||
    localStorage.getItem('generatedDisputeLetters') ||
    localStorage.getItem('disputeLetters')
  );
};
